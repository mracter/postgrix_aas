language: elixir
elixir:
  - 1.6.6
otp_release:
  - 20.3
dist: trusty
cache: apt
env:
  - MIX_ENV=test
  - DOCKER_COMPOSE_VERSION=1.4.2
services:
  - docker
before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - sudo chown 999 ./cert-key.pem
  - sudo chmod 600 ./cert-key.pem
  - docker-compose up -d
  - docker exec -ti vault sh -c "vault login token=myroot && vault audit enable file file_path=/vault/logs/vault_audit.log && vault secrets enable database"
install:
  - mix local.rebar --force
  - mix local.hex --force
  - mix deps.get
script:
  - sleep 15
  - MIX_ENV=test mix do compile, coveralls.json
  - mix format --check-formatted
  - mix credo
after_script:
  - mix deps.get --only docs
  - MIX_ENV=docs mix inch.report
after_success:
  - bash <(curl -s https://codecov.io/bash)
notifications:
  recipients:
    - paracetamolboy@gmail.com